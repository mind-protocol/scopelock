# ScopeLock Backend - Environment Variables
# Copy this file to .env and fill in your actual values

# ============================================================================
# Required Configuration
# ============================================================================

# Telegram Bot Configuration
TELEGRAM_BOT_TOKEN=your_telegram_bot_token_here
TELEGRAM_CHAT_ID=your_telegram_chat_id_here

# Webhook Authentication
WEBHOOK_SECRET=your_webhook_secret_here

# JWT Secret (for Mission Deck authentication)
# Generate with: python3 -c "import secrets; print(secrets.token_urlsafe(64))"
JWT_SECRET=your_jwt_secret_here

# Backend API URL (for citizens to call back)
BACKEND_API_URL=https://scopelock.onrender.com

# ============================================================================
# Vercel Webhook Configuration
# ============================================================================

# Vercel webhook signature secret (for HMAC verification)
# Get this from: https://vercel.com/mindprotocol/scopelock/settings/webhooks
# When you create a webhook, Vercel provides a "Signing Secret"
#
# Security: Vercel signs webhook requests with HMAC-SHA1
# We verify the signature to ensure webhooks are actually from Vercel
#
# Optional: If not set, webhook accepts all requests (less secure)
VERCEL_WEBHOOK_SIGNATURE=your_vercel_webhook_signing_secret_here

# ============================================================================
# Claude CLI Configuration
# ============================================================================

# Claude credentials JSON (for Claude CLI authentication)
# Get this from: ~/.claude/.credentials.json on your local machine
# Format: Entire JSON file as a single-line string
#
# NEW FORMAT (OAuth-based, recommended):
# Example: {"claudeAiOauth":{"accessToken":"sk-ant-oat01-...","refreshToken":"sk-ant-ort01-...","expiresAt":1762479855036,"scopes":["user:inference","user:profile"],"subscriptionType":"max"},"mcpOAuth":{...}}
#
# OLD FORMAT (sessionKey, legacy):
# Example: {"sessionKey":"sk_ant_...","email":"you@example.com"}
#
# To get your credentials: cat ~/.claude/.credentials.json | jq -c
CLAUDE_CREDENTIALS='{"claudeAiOauth":{"accessToken":"your_access_token","refreshToken":"your_refresh_token","expiresAt":0,"scopes":[],"subscriptionType":"max"}}'

# Claude settings JSON (optional, for Claude CLI preferences)
# Get this from: ~/.claude/settings.json on your local machine
# Format: Entire JSON file as a single-line string
# Example: {"model":"claude-sonnet-4.5","maxTokens":8000}
# If not set, Claude CLI will use defaults
CLAUDE_SETTINGS='{"model":"claude-sonnet-4.5","maxTokens":8000}'

# ============================================================================
# Optional Configuration
# ============================================================================

# Environment (production, staging, development)
ENVIRONMENT=production

# Log level (DEBUG, INFO, WARNING, ERROR)
LOG_LEVEL=INFO

# CORS Origins (comma-separated)
# Add your frontend domains here
CORS_ORIGINS=https://scopelock.mindprotocol.ai,http://localhost:3000

# Data directory (for file storage on Render persistent disk)
# Default: /var/data (Render persistent disk mount path)
# DATA_DIR=/var/data

# ============================================================================
# Telegram Outreach Mission Configuration
# ============================================================================

# FalkorDB Connection (Graph Database for Outreach Data)
FALKORDB_API_URL=https://mindprotocol.onrender.com/admin/query
FALKORDB_API_KEY=your_falkordb_api_key_here
GRAPH_NAME=scopelock

# Telegram API Credentials (for Telethon client)
# How to get:
#   1. Go to https://my.telegram.org
#   2. Log in with your phone number
#   3. Navigate to "API development tools"
#   4. Create application: Title="ScopeLock Dashboard", Platform="Other"
#   5. Copy api_id (numeric) and api_hash (hexadecimal)
TELEGRAM_API_ID=12345678
TELEGRAM_API_HASH=0123456789abcdef0123456789abcdef

# Fernet Encryption Key (for session string storage)
# How to generate:
#   python -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
# CRITICAL:
#   - NEVER commit this key to Git
#   - Keep backup of production key in secure password manager
#   - Losing this key means all stored sessions become unusable
FERNET_ENCRYPTION_KEY=xK8jD3mP9nQ2rT5vW8yZ1aB4cE6fG9hJ0kL3mN6pQ7s=

# Maya AI Integration
# Note: Maya AI message generation uses Claude Code subprocess invocation
# The subprocess uses CLAUDE_CREDENTIALS from the section above
# No additional environment variables required for Telegram Outreach
# Verification: Check backend startup logs for "âœ… Claude credentials written"

# ============================================================================
# Verification Commands (Telegram Outreach)
# ============================================================================

# Test FalkorDB connection:
#   cd backend
#   python -c "
#   import os, requests
#   from dotenv import load_dotenv
#   load_dotenv()
#   url = os.getenv('FALKORDB_API_URL')
#   api_key = os.getenv('FALKORDB_API_KEY')
#   graph = os.getenv('GRAPH_NAME')
#   response = requests.post(
#       url,
#       headers={'Content-Type': 'application/json', 'X-API-Key': api_key},
#       json={'graph_name': graph, 'query': 'MATCH (n) RETURN count(n)'},
#       timeout=10
#   )
#   print('FalkorDB:', 'OK' if response.status_code == 200 else 'FAILED')
#   "

# Test Telegram API connection:
#   python -c "
#   from telethon import TelegramClient
#   from telethon.sessions import StringSession
#   import asyncio, os
#   from dotenv import load_dotenv
#   load_dotenv()
#   async def test():
#       client = TelegramClient(
#           StringSession(),
#           int(os.getenv('TELEGRAM_API_ID')),
#           os.getenv('TELEGRAM_API_HASH')
#       )
#       await client.connect()
#       print('Telegram API: OK')
#       await client.disconnect()
#   asyncio.run(test())
#   "

# Test Fernet encryption:
#   python -c "
#   from cryptography.fernet import Fernet
#   import os
#   from dotenv import load_dotenv
#   load_dotenv()
#   key = os.getenv('FERNET_ENCRYPTION_KEY').encode()
#   cipher = Fernet(key)
#   test = cipher.encrypt(b'test').decode()
#   assert cipher.decrypt(test.encode()) == b'test'
#   print('Fernet encryption: OK')
#   "

# ============================================================================
# Documentation
# ============================================================================

# Full setup guide: docs/missions/telegram-outreach/GUIDE.md
# Acceptance criteria: docs/missions/telegram-outreach/AC.md
# Architecture: docs/missions/telegram-outreach/MECHANISM.md
