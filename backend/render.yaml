# Render Deployment Configuration
# https://render.com/docs/yaml-spec
#
# Minimal file-based backend: webhooks + Telegram + Claude CLI runner
# Cost: $7/month (Starter plan) - NO DATABASE

services:
  # FastAPI Backend (file-based, no PostgreSQL)
  - type: web
    name: scopelock-backend
    runtime: python
    plan: starter  # $7/month
    region: oregon
    branch: main
    rootDir: backend
    buildCommand: "pip install --upgrade pip && pip install -r requirements.txt"
    startCommand: "uvicorn app.main:app --host 0.0.0.0 --port $PORT --workers 2"

    # Persistent disk for file storage (drafts, events)
    disk:
      name: scopelock-data
      mountPath: /var/data
      sizeGB: 1  # Free: 1GB included

    envVars:
      # Required (set in Render dashboard - NOT in git)
      - key: TELEGRAM_BOT_TOKEN
        sync: false
      - key: TELEGRAM_CHAT_ID
        sync: false
      - key: WEBHOOK_SECRET
        sync: false

      # Paths
      - key: SCOPELOCK_REPO
        value: "/home/mind-protocol/scopelock"
      - key: DATA_DIR
        value: "/var/data"

      # Python Config
      - key: PYTHON_VERSION
        value: "3.11"
      - key: PYTHONUNBUFFERED
        value: "1"

      # App Config
      - key: LOG_LEVEL
        value: "INFO"
      - key: ENVIRONMENT
        value: "production"

    # Health checks
    healthCheckPath: /health

    # Build settings
    buildFilter:
      paths:
        - backend/**
