# Render Deployment Configuration
# https://render.com/docs/yaml-spec
#
# Full repo deployment: backend + citizens + Claude CLI
# Cost: $7/month (Starter plan) - NO DATABASE

services:
  # FastAPI Backend with Claude CLI support (Docker)
  - type: web
    name: scopelock-backend
    runtime: docker
    plan: starter  # $7/month
    region: oregon
    branch: main
    rootDir: backend
    dockerfilePath: ./Dockerfile
    dockerContext: ..  # Build from repo root to include citizens/

    # Persistent disk for file storage (drafts, events)
    disk:
      name: scopelock-data
      mountPath: /var/data
      sizeGB: 1  # Free: 1GB included

    envVars:
      # Required (set in Render dashboard - NOT in git)
      - key: TELEGRAM_BOT_TOKEN
        sync: false
      - key: TELEGRAM_CHAT_ID
        sync: false
      - key: WEBHOOK_SECRET
        sync: false

      # Paths (Docker image has full repo at /app)
      - key: SCOPELOCK_REPO
        value: "/app"
      - key: DATA_DIR
        value: "/var/data"
      - key: CITIZENS_DIR
        value: "/app/citizens"

      # Python Config
      - key: PYTHONUNBUFFERED
        value: "1"

      # App Config
      - key: LOG_LEVEL
        value: "INFO"
      - key: ENVIRONMENT
        value: "production"

    # Health checks
    healthCheckPath: /health

    # Build settings
    buildFilter:
      paths:
        - backend/**
        - citizens/**
